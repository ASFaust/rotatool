{% extends 'base.html' %}

{% block content %}
<h1>Shifts</h1>
<p>Manage shifts here.</p>

<table class="shifts-table">
    <thead>
        <tr>
            <th>Shift Name</th>
            <th>Every Day?</th>
            <th>Day of the Week</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Monitoring</th>
            <th>PA</th>
            <th>Other Area</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for shift in shifts %}
        <tr>
            <td>{{ shift.name }}</td>
            <td>{{ 'Yes' if shift.is_daily else 'No'}}</td>
            <td>{{ shift.day_of_the_week if shift.day_of_the_week else 'N/A' }}</td>
            <td>{{ shift.start_time }}</td>
            <td>{{ shift.end_time }}</td>
            <td>{{ 'Yes' if shift.monitoring else 'No' }}</td>
            <td>{{ 'Yes' if shift.pa else 'No' }}</td>
            <td>{{ 'Yes' if shift.other_area else 'No' }}</td>
            <td>
                <button type="button" class="edit-button" onclick="editShift('{{ shift.id }}', '{{ shift.name }}', {{ 'true' if shift.is_daily else 'false' }}, '{{ shift.day_of_the_week }}', '{{ shift.start_time }}', '{{ shift.end_time }}', {{ 'true' if shift.monitoring else 'false' }}, {{ 'true' if shift.pa else 'false' }}, {{ 'true' if shift.other_area else 'false' }})">Edit</button>
                <form action="/delete_shift/{{ shift.id }}" method="POST" style="display:inline;" onsubmit="confirmDelete(event)">
                    <button type="submit" class="delete-button">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="editForm" style="display: none;">
    <h3>Editing <span id="editShiftName"></span></h3>
    <form id="editShiftForm" action="/edit_shift" method="POST">
        <input type="hidden" id="editShiftId" name="id">
        <table>
            <tr>
                <td><label for="editName">Name:</label></td>
                <td><input type="text" id="editName" name="name"></td>
            </tr>
            <tr>
                <td><label for="editIsDaily">Daily:</label></td>
                <td><input type="checkbox" id="editIsDaily" name="is_daily" onchange="toggleDateFields()"></td>
            </tr>
            <tr>
                <td><label for="editDayOfTheWeek">Day of the Week:</label></td>
                <td><input type="text" id="editDayOfTheWeek" name="day_of_the_week"></td>
            </tr>
            <tr>
                <td><label for="editStartTime">Start Time:</label></td>
                <td><input type="time" id="editStartTime" name="start_time"></td>
            </tr>
            <tr>
                <td><label for="editEndTime">End Time:</label></td>
                <td><input type="time" id="editEndTime" name="end_time"></td>
            </tr>
            <tr>
                <td><label for="editMonitoring">Monitoring:</label></td>
                <td><input type="checkbox" id="editMonitoring" name="monitoring"></td>
            </tr>
            <tr>
                <td><label for="editPA">PA:</label></td>
                <td><input type="checkbox" id="editPA" name="pa"></td>
            </tr>
            <tr>
                <td><label for="editOtherArea">Other Area:</label></td>
                <td><input type="checkbox" id="editOtherArea" name="other_area"></td>
            </tr>
            <tr>
                <td colspan="2">
                    <button type="submit">Save</button>
                    <button type="button" onclick="cancelEdit()">Cancel</button>
                </td>
            </tr>
        </table>
    </form>
</div>

<form id="addShiftForm" action="/add_shift" method="POST">
    <h3>Add Shift</h3>
    <table>
        <tr>
            <td><label for="name">Name:</label></td>
            <td><input type="text" name="name" required></td>
        </tr>
        <tr>
            <td><label for="is_daily">Daily:</label></td>
            <td><input type="checkbox" name="is_daily" onchange="toggleDateFields()"></td>
        </tr>
        <tr>
            <td><label for="day_of_the_week">Day of the Week:</label></td>
            <td><input type="text" name="day_of_the_week"></td>
        </tr>
        <tr>
            <td><label for="start_time">Start Time:</label></td>
            <td><input type="time" name="start_time" required></td>
        </tr>
        <tr>
            <td><label for="end_time">End Time:</label></td>
            <td><input type="time" name="end_time" required></td>
        </tr>
        <tr>
            <td><label for="monitoring">Monitoring:</label></td>
            <td><input type="checkbox" name="monitoring"></td>
        </tr>
        <tr>
            <td><label for="pa">PA:</label></td>
            <td><input type="checkbox" name="pa"></td>
        </tr>
        <tr>
            <td><label for="other_area">Other Area:</label></td>
            <td><input type="checkbox" name="other_area"></td>
        </tr>
        <tr>
            <td colspan="2"><button type="submit">Add Shift</button></td>
        </tr>
    </table>
</form>

<script>
function toggleDateFields() {
    var isDaily = document.querySelector('input[name="is_daily"]').checked;
    var dayOfTheWeekInput = document.querySelector('input[name="day_of_the_week"]');
    dayOfTheWeekInput.disabled = isDaily;
    dayOfTheWeekInput.style.backgroundColor = isDaily ? '#e9ecef' : '';
}

function editShift(id, name, isDaily, dayOfTheWeek, startTime, endTime, monitoring, pa, otherArea) {
    document.getElementById('editForm').style.display = 'block';
    document.getElementById('addShiftForm').style.display = 'none';
    document.getElementById('editShiftName').textContent = name;
    document.getElementById('editShiftId').value = id;
    document.getElementById('editName').value = name;
    document.getElementById('editIsDaily').checked = isDaily;
    document.getElementById('editDayOfTheWeek').value = dayOfTheWeek;
    document.getElementById('editStartTime').value = startTime;
    document.getElementById('editEndTime').value = endTime;
    document.getElementById('editMonitoring').checked = monitoring;
    document.getElementById('editPA').checked = pa;
    document.getElementById('editOtherArea').checked = otherArea;
    toggleDateFields();
}

function cancelEdit() {
    document.getElementById('editForm').style.display = 'none';
    document.getElementById('addShiftForm').style.display = 'block';
    document.getElementById('editShiftForm').reset();
}

function confirmDelete(event) {
    if (!confirm("Do you really want to delete?")) {
        event.preventDefault();
    }
}
</script>
{% endblock %}